# Makefile for {{ env_name }} environment
# Generated by qdpi on {{ created_at }}

.PHONY: help install dev build test clean

help:
	@echo "{{ env_name }} environment commands:"
	@echo ""
	@echo "  make install  - Install dependencies for all repos"
	@echo "  make dev      - Start development servers"
	@echo "  make build    - Build all projects"
	@echo "  make test     - Run tests"
	@echo "  make clean    - Clean build artifacts"

{% if 'backend' in repo_names %}
# Backend service
install-backend:
	cd backend && pip install -r requirements.txt

run-backend:
	cd backend && python main.py --host 0.0.0.0 --port 8000

{% endif %}
{% if 'frontend' in repo_names %}
# Frontend application
install-frontend:
	cd frontend && npm install

run-frontend:
	cd frontend && npm run dev

build-frontend:
	cd frontend && npm run build

{% endif %}

# Combined targets
install:{% if 'backend' in repo_names %} install-backend{% endif %}{% if 'frontend' in repo_names %} install-frontend{% endif %}

	@echo "Dependencies installed!"

dev:
	@echo "Starting development servers..."
{% if 'backend' in repo_names %}
	@echo "Run 'make run-backend' in one terminal"
{% endif %}
{% if 'frontend' in repo_names %}
	@echo "Run 'make run-frontend' in another terminal"
{% endif %}

build:{% if 'frontend' in repo_names %} build-frontend{% endif %}

	@echo "Build complete!"

test:
{% if 'backend' in repo_names %}
	cd backend && python -m pytest tests/ -v
{% endif %}
{% if 'frontend' in repo_names %}
	cd frontend && npm test
{% endif %}

clean:
{% if 'frontend' in repo_names %}
	rm -rf frontend/node_modules
	rm -rf frontend/dist
{% endif %}
	@echo "Cleaned!"
